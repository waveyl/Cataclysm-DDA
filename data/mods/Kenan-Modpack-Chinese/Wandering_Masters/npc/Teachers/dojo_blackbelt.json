[
  {
    "//": "TODO check text for mistakes, maybe balance him a bit",
    "type": "npc",
    "id": "NPC_blackbelt_coach",
    "name_suffix": "铁掌",
    "class": "NC_blackbelt_coach",
    "attitude": 0,
    "mission": 7,
    "chat": "TALK_blackbelt_coach_1",
    "faction": "iron_palm",
    "mission_offered": "MISSION_blackbelt_coach_1"
  },
  {
    "type": "npc_class",
    "id": "NC_blackbelt_coach",
    "name": {
      "str": "Black Belt Coach"
    },
    "job_description": "Black Belt Coach.",
    "common": false,
    "bonus_str": {
      "rng": [
        2,
        4
      ]
    },
    "bonus_dex": {
      "rng": [
        2,
        4
      ]
    },
    "bonus_int": {
      "rng": [
        1,
        2
      ]
    },
    "bonus_per": {
      "rng": [
        1,
        2
      ]
    },
    "worn_override": "NC_blackbelt_coach_worn",
    "weapon_override": "EMPTY_GROUP",
    "traits": [
      {
        "group": "NPC_starting_traits"
      },
      {
        "group": "Appearance_demographics"
      },
      {
        "trait": "PAINRESIST"
      }
    ],
    "skills": [
      {
        "skill": "unarmed",
        "bonus": {
          "rng": [
            4,
            8
          ]
        }
      },
      {
        "skill": "dodge",
        "bonus": {
          "rng": [
            4,
            8
          ]
        }
      }
    ]
  },
  {
    "type": "item_group",
    "id": "NC_blackbelt_coach_worn",
    "subtype": "collection",
    "entries": [
      {
        "item": "karate_gi"
      },
      {
        "item": "judo_belt_black"
      },
      {
        "item": "mouthpiece"
      },
      {
        "item": "geta"
      },
      {
        "item": "boxer_shorts"
      },
      {
        "item": "shorts_denim"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": [
      "TALK_blackbelt_coach_1"
    ],
    "dynamic_line": {
      "npc_has_var": "u_helped_blackbelt_coach",
      "type": "general",
      "context": "meeting",
      "value": "yes",
      "yes": "很高兴再次见到我最好的学生。",
      "no": "你好，学生！准备好学习铁掌之道了吗？"
    },
    "speaker_effect": {
      "sentinel": "met",
      "effect": {
        "add_mission": "MISSION_blackbelt_coach_0"
      }
    },
    "responses": [
      {
        "text": "关于那个任务……",
        "condition": "has_many_assigned_missions",
        "trial": {
          "type": "CONDITION",
          "condition": {
            "and": [
              {
                "u_is_wearing": "karate_gi"
              },
              {
                "u_is_wearing": "geta"
              },
              {
                "or": [
                  {
                    "u_is_wearing": "judo_belt_white"
                  },
                  {
                    "u_is_wearing": "judo_belt_yellow"
                  },
                  {
                    "u_is_wearing": "judo_belt_green"
                  },
                  {
                    "u_is_wearing": "judo_belt_blue"
                  },
                  {
                    "u_is_wearing": "judo_belt_black"
                  }
                ]
              }
            ]
          }
        },
        "success": {
          "topic": "TALK_MISSION_INQUIRE"
        },
        "failure": {
          "topic": "TALK_blackbelt_coach_nope",
          "effect": [
            {
              "npc_add_var": "blackbelt_coach_student",
              "type": "flag",
              "context": "meeting",
              "value": "yes"
            }
          ]
        }
      },
      {
        "text": "<BGSS_intro_question>",
        "topic": "TALK_blackbelt_coach_Background"
      },
      {
        "text": "需要帮忙么？",
        "trial": {
          "type": "CONDITION",
          "condition": {
            "and": [
              {
                "u_is_wearing": "karate_gi"
              },
              {
                "u_is_wearing": "geta"
              }
            ]
          }
        },
        "success": {
          "topic": "TALK_MISSION_LIST"
        },
        "failure": {
          "topic": "TALK_blackbelt_coach_nope",
          "effect": [
            {
              "npc_add_var": "blackbelt_coach_student",
              "type": "flag",
              "context": "meeting",
              "value": "yes"
            }
          ]
        }
      },
      {
        "text": "你能教我点什么吗？",
        "topic": "TALK_blackbelt_coach_teach_check"
      },
      {
        "text": "我怎样才能成为你的学生？",
        "topic": "blackbelt_coach_student",
        "condition": {
          "npc_has_var": "blackbelt_coach_student",
          "type": "flag",
          "context": "meeting",
          "value": "yes"
        }
      },
      {
        "text": "那帮助呢？",
        "topic": "TALK_blackbelt_coach_flame_knuckle_1",
        "condition": {
          "npc_has_var": "bbm_flame_knuckle",
          "type": "general",
          "context": "flag",
          "value": "yes"
        },
        "effect": [
          {
            "npc_change_faction": "flame_knuckle"
          },
          {
            "u_faction_rep": 100
          },
          {
            "npc_change_faction": "no_faction"
          },
          {
            "u_spawn_item": "flyer_fk"
          },
          {
            "npc_lose_var": "bbm_flame_knuckle",
            "type": "general",
            "context": "flag"
          }
        ]
      },
      {
        "text": "再见。",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_Background",
    "dynamic_line": "好吧，如果你想知道的话，我们必须在<the_cataclysm>之前开始。有两个学校，铁掌和火焰指节。我们的道场很快就分崩离析了，我的学生，甚至我的一些师父同伴都去参加暴乱了。好像他们忘记了自己的教诲。留下来的人变成了在街上游荡的<zombies>。火焰指节不知何故没有感受到和我们一样的毁灭，他们很快适应了新世界，扩大了人口，为外界提供了保护和训练。但他们保留了他们的不满，决定结束我们的道场，我必须阻止这种事情发生。",
    "responses": [
      {
        "text": "<done_conversation_section>",
        "topic": "TALK_NONE"
      },
      {
        "text": "我觉得你在撒谎。",
        "condition": {
          "not": {
            "npc_has_var": "blackbelt_coach_background",
            "type": "general",
            "context": "meeting",
            "value": "yes"
          }
        },
        "trial": {
          "type": "PERSUADE",
          "difficulty": 8
        },
        "success": {
          "topic": "TALK_blackbelt_coach_truth"
        },
        "failure": {
          "topic": "TALK_blackbelt_coach_truth"
        }
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_teach_check",
    "dynamic_line": "我只教那些帮助过我学校的人。你帮过我的学校吗？",
    "responses": [
      {
        "text": "是的，主人。",
        "condition": {
          "npc_has_var": "u_helped_blackbelt_coach",
          "type": "general",
          "context": "meeting",
          "value": "yes"
        },
        "trial": {
          "type": "CONDITION",
          "condition": {
            "npc_has_var": "blackbelt_coach_teach",
            "type": "general",
            "context": "meeting",
            "value": "yes"
          }
        },
        "success": {
          "effect": [
            {
              "u_spawn_item": "manual_karate"
            },
            {
              "npc_lose_var": "blackbelt_coach_teach",
              "type": "general",
              "context": "meeting"
            }
          ],
          "topic": "TALK_blackbelt_coach_teach"
        },
        "failure": {
          "topic": "TALK_blackbelt_coach_teach_done"
        }
      },
      {
        "text": "也许以后…",
        "topic": "TALK_NONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_teach",
    "dynamic_line": "你帮我重建了我的学校，所以来，拿去吧。这是我们学校的遗物之一，《手册》。你现在可以接受了。祝你好运，学生。别让你自己死！",
    "responses": [
      {
        "text": "多谢师父！",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_teach_done",
    "dynamic_line": "我已经把我知道的都教给你了。",
    "responses": [
      {
        "text": "再次感谢师父。",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_truth",
    "dynamic_line": "什么？！主人不说谎！你想感受我钢铁般的愤怒吗？你想感受真正的痛苦？！",
    "responses": [
      {
        "text": "对不起，师傅！请不要杀我！",
        "topic": "TALK_blackbelt_coach_1",
        "effect": [
          {
            "npc_add_var": "blackbelt_coach_background",
            "type": "general",
            "context": "meeting",
            "value": "yes"
          }
        ]
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_nope",
    "dynamic_line": "我只是在和我的学生谈论我的问题！",
    "responses": [
      {
        "text": "对不起，师傅！",
        "topic": "TALK_NONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_student",
    "dynamic_line": "首先，你需要找到合适的制服。你应该穿着空手道服训练。顺便，从那些学徒之路走到头的人那里“借”一套来穿，原本是严禁的，但在如今这可怖的情况下，暂时允许你这样做。",
    "responses": [
      {
        "text": "我明白了。我拿到制服就回来！",
        "topic": "TALK_DONE",
        "effect": [
          {
            "npc_lose_var": "blackbelt_coach_student",
            "type": "flag",
            "context": "meeting"
          }
        ]
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_blackbelt_coach_flame_knuckle_1",
    "dynamic_line": "拿着这个。这是我线人给我的学校传单之一。他说他们现在用它当请柬。我希望你能找到它的用处。祝你好运，学生。",
    "responses": [
      {
        "text": "多谢师父。",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "blackbelt_coach_wu",
    "dynamic_line": "…",
    "responses": [
      {
        "text": "我回来了。",
        "topic": "TALK_blackbelt_coach_1",
        "condition": {
          "and": [
            {
              "not": {
                "u_has_var": "fkl_business",
                "type": "flag",
                "context": "meeting",
                "value": "yes"
              }
            },
            {
              "not": {
                "u_has_var": "blackbelt_coach_m1",
                "type": "general",
                "context": "meeting",
                "value": "no"
              }
            }
          ]
        }
      },
      {
        "text": "…",
        "topic": "TALK_MISSION_FAILURE",
        "condition": {
          "or": [
            {
              "u_has_var": "fkl_business",
              "type": "flag",
              "context": "meeting",
              "value": "yes"
            },
            {
              "u_has_var": "blackbelt_coach_m1",
              "type": "general",
              "context": "meeting",
              "value": "no"
            }
          ]
        },
        "effect": [
          "mission_failure"
        ],
        "switch": true
      },
      {
        "text": "对不起，师傅，但你必须死。",
        "topic": "TALK_DONE",
        "condition": {
          "u_has_var": "fkl_end_ip",
          "type": "flag",
          "context": "meeting",
          "value": "yes"
        },
        "effect": [
          "insult_combat",
          {
            "u_lose_var": "fkl_end_ip",
            "type": "flag",
            "context": "meeting"
          }
        ]
      },
      {
        "text": "…",
        "topic": "TALK_DONE",
        "switch": true
      }
    ]
  },
  {
    "id": "MISSION_blackbelt_coach_1",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": {
      "str": "找到线人"
    },
    "description": "找到那个潜入“烈火指”学校的线人，和他谈谈。",
    "goal": "MGOAL_CONDITION",
    "goal_condition": {
      "u_has_var": "blackbelt_coach_m1",
      "type": "general",
      "context": "meeting",
      "value": "yes"
    },
    "difficulty": 0,
    "value": 1000,
    "start": {
      "effect": [
        {
          "npc_first_topic": "blackbelt_coach_wu"
        },
        {
          "u_spawn_item": "judo_belt_white"
        }
      ],
      "assign_mission_target": {
        "om_terrain": "forest",
        "om_terrain_replace": "field",
        "om_terrain_match_type": "PREFIX",
        "reveal_radius": 1,
        "search_range": 40,
        "min_distance": 3
      },
      "update_mapgen": {
        "place_npcs": [
          {
            "class": "NPC_flame_knuckle_apprentice_informer",
            "x": 5,
            "y": 5
          }
        ]
      }
    },
    "end": {
      "effect": [
        {
          "u_consume_item": "judo_belt_white"
        },
        {
          "u_spawn_item": "judo_belt_yellow"
        },
        {
          "npc_first_topic": "TALK_blackbelt_coach_1"
        }
      ]
    },
    "origins": [
      "ORIGIN_SECONDARY"
    ],
    "followup": "MISSION_blackbelt_coach_2",
    "dialogue": {
      "describe": "-",
      "offer": "你决定帮我？好的，听着，学生。我设法招募了一名幸存者，说服他加入“火焰指节”组织，把他能得到的所有信息都泄露给我。下一次收集信息的时候到了。在附近的森林里遇见他，从他那里得到他所知道的一切，然后回来。哦，是的，我们的密码是“浆果”。别忘了密码！",
      "accepted": "我完全信任你。拿着这条腰带，当作你进入铁掌学校的标志！去吧，在你完成任务之前别来找我！",
      "rejected": "你害怕吗？",
      "advice": "小心。那家伙可能已经暴露了，所以回来时尽量不要留下踪迹。",
      "inquire": "我会一直在这里等你。",
      "success": "干得好，学生。我就知道你会成功！好吧，告诉我你所有的…嗯，就是这样。嗯，这让我的工作有点复杂。我需要一点时间考虑一下。这里，抓住这条腰带，你应得的。",
      "success_lie": "-",
      "failure": "你是你家人的耻辱！"
    },
    "fail": {
      "effect": [
        "end_conversation",
        {
          "u_lose_var": "blackbelt_coach_m1",
          "type": "general",
          "context": "meeting"
        },
        {
          "u_consume_item": "judo_belt_white"
        }
      ]
    }
  },
  {
    "id": "MISSION_blackbelt_coach_2",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": {
      "str": "杀了一个训练员"
    },
    "description": "师父让你先杀了一个火焰拳学校的训练员，然后他才能训练一批新的学生。",
    "goal": "MGOAL_ASSASSINATE",
    "difficulty": 0,
    "value": 100,
    "deadline_low": 14,
    "deadline_high": 28,
    "start": {
      "effect": [
        {
          "npc_first_topic": "blackbelt_coach_wu"
        }
      ],
      "assign_mission_target": {
        "om_terrain": "dojo_1",
        "om_terrain_replace": "house",
        "om_terrain_match_type": "PREFIX",
        "reveal_radius": 1,
        "search_range": 200,
        "min_distance": 25
      },
      "update_mapgen": {
        "place_npcs": [
          {
            "class": "NPC_flame_knuckle_apprentice",
            "x": 10,
            "y": 13
          },
          {
            "class": "NPC_flame_knuckle_apprentice",
            "x": 11,
            "y": 13
          },
          {
            "class": "NPC_flame_knuckle_apprentice",
            "x": 12,
            "y": 13
          },
          {
            "class": "NPC_flame_knuckle_apprentice",
            "x": 13,
            "y": 13
          },
          {
            "class": "NPC_flame_knuckle_apprentice",
            "x": 14,
            "y": 13
          },
          {
            "class": "NPC_flame_knuckle_elite_coach",
            "x": 12,
            "y": 12,
            "target": true
          }
        ]
      }
    },
    "end": {
      "effect": [
        {
          "u_consume_item": "judo_belt_yellow"
        },
        {
          "u_spawn_item": "judo_belt_green"
        }
      ]
    },
    "origins": [
      "ORIGIN_SECONDARY"
    ],
    "followup": "MISSION_blackbelt_coach_3",
    "dialogue": {
      "describe": "-",
      "offer": "多亏了你给我的消息，我才知道火焰指节是派他们的一个精英去训练一批新的学徒，我希望你能阻止这一切。找到这个<name_b>，用你的铁掌，让他被血呛死！什么？学生们呢？我不在乎<swear>，你想怎么做就怎么做。哦，是的，他们的训练大约需要2-4周，所以快点！他们不会永远坐在那里！",
      "accepted": "我喜欢你的态度。向他们展示铁掌的真谛吧！",
      "rejected": "你在怕什么？！",
      "advice": "那些学徒都是无名小卒，但教练却是学校里实力顶尖的人物。尽量小心。",
      "inquire": "我会一直在这里等你。",
      "success": "不错，学生！这将教会他们不要惹我，惹我的学校和学生！",
      "success_lie": "-",
      "failure": "你是你家人的耻辱！"
    },
    "fail": {
      "effect": [
        "end_conversation",
        {
          "u_consume_item": "judo_belt_yellow"
        }
      ]
    }
  },
  {
    "id": "MISSION_blackbelt_coach_3",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": {
      "str": "结果“烈火指”"
    },
    "description": "是时候彻底结束这段感情了。",
    "goal": "MGOAL_ASSASSINATE",
    "difficulty": 0,
    "value": 100,
    "deadline_low": 7,
    "deadline_high": 14,
    "start": {
      "effect": [
        {
          "npc_add_var": "bbm_flame_knuckle",
          "type": "general",
          "context": "flag",
          "value": "yes"
        }
      ],
      "assign_mission_target": {
        "om_terrain": "fk_base_2",
        "om_special": "Flame Knuckle base",
        "om_terrain_replace": "forest",
        "om_terrain_match_type": "PREFIX",
        "cant_see": true,
        "reveal_radius": 1,
        "search_range": 200,
        "min_distance": 50
      },
      "update_mapgen": {
        "place_npcs": [
          {
            "class": "NPC_flame_knuckle_leader",
            "x": 2,
            "y": 11,
            "target": true
          }
        ]
      }
    },
    "end": {
      "effect": [
        {
          "u_consume_item": "judo_belt_green"
        },
        {
          "u_spawn_item": "judo_belt_blue"
        }
      ]
    },
    "origins": [
      "ORIGIN_SECONDARY"
    ],
    "followup": "MISSION_blackbelt_coach_4",
    "dialogue": {
      "describe": "-",
      "offer": "所以，我的学生，是时候开始真正的拳击了！我设法找到了他们的基地，甚至得知他们的首领也会在那里。我要你去那里，向他们展示铁掌的力量，给我拿他们首领的头像作为证据。你是我最好的学生，所以对你来说不难。",
      "accepted": "很好。他至少要在那里呆一个星期。如果你不想对付他手下那些混子就找到他，问我吧，我有个主意…",
      "rejected": "你在怕什么？！",
      "advice": "我对他们的基地知之甚少，但听说有一群骗子向他们寻求了庇护，那些是训练新生的教练，可能还有些别的人。如果你看到戴面具的人，那都是高层，所以在处理他们时要<very>小心。",
      "inquire": "所以呢？",
      "success": "好，<very>好，我的学生。现在我的学校有机会再次崛起了！拿上这条腰带，这是你应得的。",
      "success_lie": "-",
      "failure": "你是你家人的耻辱！"
    },
    "fail": {
      "effect": [
        "end_conversation",
        {
          "u_consume_item": "judo_belt_green"
        }
      ]
    }
  },
  {
    "id": "MISSION_blackbelt_coach_4",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": {
      "str": "招揽几个学生"
    },
    "description": "招揽学生。",
    "goal": "MGOAL_CONDITION",
    "goal_condition": {
      "u_has_var": "bbm_students",
      "type": "flag",
      "context": "meeting",
      "value": "2"
    },
    "difficulty": 0,
    "value": 1000,
    "start": {
      "effect": [
        {
          "u_add_var": "bbm_students",
          "type": "flag",
          "context": "meeting",
          "value": "0"
        },
        {
          "u_add_var": "ally_transfer_ip",
          "type": "flag",
          "context": "transfer",
          "value": "yes"
        }
      ]
    },
    "end": {
      "effect": [
        {
          "u_consume_item": "judo_belt_blue"
        },
        {
          "u_spawn_item": "judo_belt_black"
        },
        {
          "npc_add_var": "u_helped_blackbelt_coach",
          "type": "general",
          "context": "meeting",
          "value": "yes"
        },
        {
          "npc_add_var": "blackbelt_coach_teach",
          "type": "general",
          "context": "meeting",
          "value": "yes"
        },
        {
          "u_lose_var": "ally_transfer_ip",
          "type": "flag",
          "context": "transfer"
        },
        {
          "u_lose_var": "bbm_students",
          "type": "flag",
          "context": "meeting"
        }
      ]
    },
    "fail": {
      "effect": [
        {
          "u_lose_var": "ally_transfer_ip",
          "type": "flag",
          "context": "transfer"
        },
        {
          "u_lose_var": "bbm_students",
          "type": "flag",
          "context": "meeting"
        }
      ]
    },
    "origins": [
      "ORIGIN_SECONDARY"
    ],
    "dialogue": {
      "describe": "-",
      "offer": "所以，我的学生，是时候恢复我的学校了。给我带两个新学生来，这样我就能把他们训练成世界上最好的战士了！",
      "accepted": "好的，我等着。",
      "rejected": "怕了吗？",
      "advice": "说实话，我觉得你比我更了解外面的世界，所以我没有给你什么建议，除了好运！",
      "inquire": "我会一直在这里等你。",
      "success": "我不知道该说什么，我的学生。拿上这条腰带吧。这是你用血与泪赢得的。如果你想得到额外的训练，尽管跟我说。我会尽我所能教你我们学校所有的秘密！",
      "success_lie": "-",
      "failure": "你是你家人的耻辱！"
    }
  },
  {
    "id": "MISSION_blackbelt_coach_0",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": {
      "str": "你见过铁掌掌门"
    },
    "goal": "MGOAL_CONDITION",
    "goal_condition": {
      "u_has_var": "-",
      "type": "general",
      "context": "meeting",
      "value": "yes"
    },
    "difficulty": 0,
    "value": 0,
    "origins": [
      "ORIGIN_SECONDARY"
    ],
    "dialogue": {
      "describe": "-",
      "offer": "-",
      "accepted": "-",
      "rejected": "-",
      "advice": "-",
      "inquire": "-",
      "success": "-",
      "success_lie": "-",
      "failure": "-"
    },
    "fail": {
      "effect": {
        "u_spawn_item": "ip_leader_head"
      }
    }
  }
]