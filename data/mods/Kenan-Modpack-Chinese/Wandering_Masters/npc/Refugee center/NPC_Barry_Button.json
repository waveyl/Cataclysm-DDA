[
  {
    "//": "TODO check text, maybe add something more",
    "type": "npc",
    "id": "NPC_Barry_Button",
    "name_unique": "巴里·巴顿",
    "gender": "male",
    "name_suffix": "难民",
    "class": "NC_SCAVENGER",
    "attitude": 0,
    "mission": 7,
    "chat": "TALK_Barry_Button_1",
    "faction": "free_merchants",
    "mission_offered": "MISSION_Barry_Button_1"
  },
  {
    "id": "TALK_Barry_Button_1",
    "type": "talk_topic",
    "dynamic_line": [
      {
        "u_has_var": "BarryB_met",
        "type": "general",
        "context": "meeting",
        "value": "yes",
        "yes": "Are we there yet?",
        "no": "Thank god you're here! I thougt I'm a dead man! These <name_b> put me in this dark shed with living <zombie>! Help me get out of here, <name_g>, please!"
      }
    ],
    "responses": [
      {
        "text": "你哥哥派我来的。我们快点离开这里。",
        "topic": "TALK_Barry_Button_GetOut",
        "condition": {
          "not": {
            "u_has_var": "BarryB_met",
            "type": "general",
            "context": "meeting",
            "value": "yes"
          }
        }
      },
      {
        "text": "我们到了！",
        "topic": "TALK_Barry_Button_Safe",
        "condition": {
          "npc_at_om_location": "evac_center_7"
        },
        "effect": [
          "stop_following"
        ]
      },
      {
        "text": "我们到了！",
        "topic": "TALK_Barry_Button_Safe",
        "condition": {
          "npc_at_om_location": "bank"
        },
        "effect": [
          "stop_following"
        ]
      },
      {
        "text": "马上了。",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_GetOut",
    "dynamic_line": "走吧！",
    "responses": [
      {
        "text": "…",
        "topic": "TALK_DONE",
        "effect": [
          "follow_only",
          {
            "u_add_var": "BarryB_met",
            "type": "general",
            "context": "meeting",
            "value": "yes"
          }
        ]
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_Safe",
    "dynamic_line": "呸，差一点！我欠你一个，<name_g>。让我喘口气。晚点再跟我说。",
    "responses": [
      {
        "text": "我很高兴一切都结束了。",
        "topic": "TALK_Barry_Button_2",
        "effect": [
          {
            "npc_first_topic": "TALK_Barry_Button_2"
          },
          {
            "npc_add_var": "barryb_wait",
            "type": "flag",
            "context": "meeting",
            "time": true
          }
        ]
      }
    ]
  },
  {
    "id": [
      "TALK_Barry_Button_2"
    ],
    "type": "talk_topic",
    "dynamic_line": "<greet>",
    "responses": [
      {
        "text": "关于那个任务……",
        "condition": "has_assigned_mission",
        "topic": "TALK_MISSION_INQUIRE"
      },
      {
        "text": "<BGSS_intro_question>",
        "topic": "TALK_Barry_Button_Background"
      },
      {
        "text": "那么，那份工作呢？",
        "topic": "TALK_Barry_Button_job"
      },
      {
        "text": "你能教我点什么吗？",
        "topic": "TALK_Barry_Button_teach_check",
        "condition": {
          "npc_has_var": "u_know_barryb_backstory",
          "type": "flag",
          "context": "meeting",
          "value": "yes"
        }
      },
      {
        "text": "再见。",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_job",
    "dynamic_line": {
      "npc_compare_time_since_var": "barryb_wait",
      "type": "flag",
      "context": "meeting",
      "op": ">=",
      "time": "24 h",
      "yes": "所以，我需要一些帮助。带我去最近的银行！",
      "no": "我在休息。晚点回来。"
    },
    "responses": [
      {
        "text": "当然，<name_g>。",
        "topic": "TALK_DONE",
        "condition": {
          "npc_compare_time_since_var": "barryb_wait",
          "type": "flag",
          "context": "meeting",
          "op": ">=",
          "time": "24 h"
        },
        "effect": [
          "follow_only",
          {
            "npc_first_topic": "TALK_Barry_Button_1"
          }
        ]
      },
      {
        "text": "<done_conversation_section>",
        "topic": "TALK_NONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_Background",
    "dynamic_line": "曾经我是个老师，一直想发财！现在我可以实现我的梦想了！",
    "responses": [
      {
        "text": "<done_conversation_section>",
        "topic": "TALK_NONE",
        "effect": [
          {
            "npc_add_var": "u_know_barryb_backstory",
            "type": "flag",
            "context": "meeting",
            "value": "yes"
          }
        ]
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_teach_check",
    "dynamic_line": {
      "npc_has_var": "u_helped_barry_button",
      "type": "general",
      "context": "meeting",
      "value": "yes",
      "yes": "你想学点新东西吗？我可以教你怎么读得更快，或者，如果你不知道，怎么读。",
      "no": "我还有个任务没完成。我们晚点再谈。"
    },
    "responses": [
      {
        "text": "是的，让我们这样做。",
        "condition": {
          "npc_has_var": "u_helped_barry_button",
          "type": "general",
          "context": "meeting",
          "value": "yes"
        },
        "trial": {
          "type": "CONDITION",
          "condition": {
            "npc_has_var": "barry_button_teach",
            "type": "general",
            "context": "meeting",
            "value": "yes"
          }
        },
        "success": {
          "topic": "TALK_Barry_Button_teach_check1"
        },
        "failure": {
          "topic": "TALK_Barry_Button_teach_done"
        }
      },
      {
        "text": "对不起，我不想。",
        "topic": "TALK_NONE"
      }
    ]
  },
  {
    "//": "do different lines for give_trait using switch:true",
    "type": "talk_topic",
    "id": "TALK_Barry_Button_teach_check1",
    "dynamic_line": {
      "npc_has_var": "barry_button_teach",
      "type": "general",
      "context": "meeting",
      "value": "yes",
      "yes": {
        "u_has_trait": "ILLITERATE",
        "yes": "所以，你不识字？没问题，我可以教你！",
        "no": {
          "u_has_trait": "SLOWREADER",
          "yes": "那么，你阅读速度慢？没问题，我可以教你！",
          "no": {
            "u_has_trait": "FASTREADER",
            "yes": "恐怕我什么都教不了你。",
            "no": "那么，你想学习如何快速阅读吗？没问题，我可以教你！"
          }
        }
      },
      "no": "恐怕我什么都教不了你。"
    },
    "responses": [
      {
        "text": "是的，让我们这样做。",
        "topic": "TALK_Barry_Button_teach",
        "condition": {
          "u_has_trait": "ILLITERATE"
        },
        "effect": {
          "u_lose_trait": "ILLITERATE"
        },
        "switch": true
      },
      {
        "text": "是的，让我们这样做。",
        "topic": "TALK_Barry_Button_teach",
        "condition": {
          "u_has_trait": "SLOWREADER"
        },
        "effect": {
          "u_lose_trait": "SLOWREADER"
        },
        "switch": true
      },
      {
        "text": "是的，让我们这样做。",
        "topic": "TALK_Barry_Button_teach",
        "condition": {
          "not": {
            "u_has_trait": "FASTREADER"
          }
        },
        "effect": {
          "u_add_trait": "FASTREADER"
        },
        "switch": true
      },
      {
        "text": "<done_conversation_section>",
        "topic": "TALK_NONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_teach",
    "dynamic_line": "祝你好运，学生！",
    "responses": [
      {
        "text": "谢谢，巴里！",
        "topic": "TALK_DONE",
        "effect": {
          "npc_lose_var": "barry_button_teach",
          "type": "general",
          "context": "meeting"
        }
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_Barry_Button_teach_done",
    "dynamic_line": "我已经把我知道的都教给你了。",
    "responses": [
      {
        "text": "再次感谢你，巴里。",
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "id": "MISSION_Barry_Button_1",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": {
      "str": "抢劫"
    },
    "description": "保护我！！！",
    "goal": "MGOAL_CONDITION",
    "//": "place_monsters at start",
    "goal_condition": {
      "u_compare_time_since_var": "barryb_heist",
      "type": "flag",
      "context": "meeting",
      "op": ">=",
      "time": "45 m"
    },
    "difficulty": 0,
    "value": 1000,
    "start": {
      "effect": [
        "stop_following",
        {
          "npc_add_var": "barryb_heist",
          "type": "flag",
          "context": "meeting",
          "time": true
        }
      ]
    },
    "end": {
      "effect": [
        "follow_only",
        {
          "npc_lose_var": "barryb_heist",
          "type": "flag",
          "context": "meeting"
        },
        {
          "mapgen_update": "heist_success",
          "origin_npc": true
        },
        {
          "npc_first_topic": "TALK_Barry_Button_1"
        }
      ]
    },
    "origins": [
      "ORIGIN_SECONDARY"
    ],
    "dialogue": {
      "describe": "在制品！！！",
      "offer": "在制品",
      "accepted": "在制品",
      "rejected": "在制品？",
      "advice": "在制品。",
      "inquire": "我会一直在这里等你。",
      "success": "很好，让我们回到RC。",
      "success_lie": "在制品！",
      "failure": "在制品！"
    }
  }
]